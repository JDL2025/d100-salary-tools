<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>D100 Salary Proposal Simulator | Interactive Tool</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: Arial, Helvetica, sans-serif;
            line-height: 1.6;
            color: #333;
            background: #f5f5f5;
        }
        
        /* Header matching D100 colors */
        header {
            background: #003B5C;
            color: white;
            padding: 30px 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        
        header h1 {
            font-size: 2.2em;
            margin-bottom: 5px;
        }
        
        header .subtitle {
            font-size: 1.1em;
            opacity: 0.9;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        /* Main layout - side by side on desktop */
        .tool-layout {
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 20px;
            margin-top: 20px;
            align-items: start;
        }
        
        /* Chart section - STICKY/FIXED! */
        .chart-section {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            position: sticky;
            top: 20px;
            align-self: start;
        }
        
        .chart-section h2 {
            color: #003B5C;
            margin-bottom: 20px;
            border-bottom: 3px solid #FFA500;
            padding-bottom: 10px;
        }
        
        #salaryChart {
            max-height: 500px;
        }
        
        /* Line visibility toggles */
        .line-toggles {
            margin-bottom: 25px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #ddd;
        }
        
        .line-toggles h4 {
            color: #003B5C;
            margin-bottom: 12px;
            font-size: 1em;
        }
        
        .toggle-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .toggle-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 16px;
            background: white;
            border: 2px solid;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9em;
            font-weight: 600;
            transition: all 0.3s;
            color: #333;
        }
        
        .toggle-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }
        
        .toggle-btn .toggle-indicator {
            width: 20px;
            height: 20px;
            border-radius: 4px;
            transition: opacity 0.3s;
        }
        
        .toggle-btn:not(.active) {
            opacity: 0.4;
            background: #e9ecef;
        }
        
        .toggle-btn:not(.active) .toggle-indicator {
            opacity: 0.3;
        }
        
        .toggle-btn.active {
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        /* Controls panel - SCROLLS independently */
        .controls-panel {
            background: white;
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            /* Not sticky - this scrolls normally */
        }
        
        .controls-panel h2 {
            color: #003B5C;
            margin-bottom: 20px;
            font-size: 1.5em;
        }
        
        /* Contract length selector */
        .contract-length {
            margin-bottom: 25px;
            padding: 15px;
            background: #E8F4F8;
            border-radius: 5px;
        }
        
        .contract-length label {
            display: block;
            font-weight: 600;
            color: #003B5C;
            margin-bottom: 10px;
        }
        
        .year-buttons {
            display: flex;
            gap: 10px;
        }
        
        .year-btn {
            flex: 1;
            padding: 12px;
            border: 2px solid #004D73;
            background: white;
            color: #004D73;
            font-weight: 600;
            cursor: pointer;
            border-radius: 5px;
            transition: all 0.3s;
        }
        
        .year-btn:hover {
            background: #E8F4F8;
        }
        
        .year-btn.active {
            background: #004D73;
            color: white;
        }
        
        .longevity-btn {
            flex: 1;
            padding: 12px;
            border: 2px solid #004D73;
            background: white;
            color: #004D73;
            font-weight: 600;
            cursor: pointer;
            border-radius: 5px;
            transition: all 0.3s;
        }
        
        .longevity-btn:hover {
            background: #E8F4F8;
        }
        
        .longevity-btn.active {
            background: #FFA500;
            border-color: #FFA500;
            color: white;
        }
        
        /* Control groups */
        .control-group {
            margin-bottom: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #FFA500;
        }
        
        .control-group h3 {
            color: #003B5C;
            margin-bottom: 15px;
            font-size: 1.2em;
        }
        
        .control-item {
            margin-bottom: 20px;
        }
        
        .control-item label {
            display: block;
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
        }
        
        /* Slider styling */
        input[type="range"] {
            width: 100%;
            height: 8px;
            border-radius: 5px;
            background: #ddd;
            outline: none;
            -webkit-appearance: none;
        }
        
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #004D73;
            cursor: pointer;
        }
        
        input[type="range"]::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #004D73;
            cursor: pointer;
            border: none;
        }
        
        /* Value display */
        .value-display {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 8px;
        }
        
        .current-value {
            font-size: 1.3em;
            font-weight: bold;
            color: #FFA500;
        }
        
        .range-labels {
            display: flex;
            justify-content: space-between;
            font-size: 0.85em;
            color: #666;
            margin-top: 5px;
        }
        
        /* Number input */
        input[type="number"] {
            width: 100%;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 1em;
        }
        
        input[type="number"]:focus {
            outline: none;
            border-color: #004D73;
        }
        
        /* Checkbox styling */
        .checkbox-wrapper {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }
        
        /* Longevity controls */
        .longevity-controls {
            margin-top: 15px;
            padding: 15px;
            background: white;
            border-radius: 5px;
            display: none;
        }
        
        .longevity-controls.active {
            display: block;
        }
        
        /* Reset button */
        .reset-btn {
            width: 100%;
            padding: 15px;
            background: #d9534f;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            margin-top: 20px;
            transition: background 0.3s;
        }
        
        .reset-btn:hover {
            background: #c9302c;
        }
        
        /* Impact summary */
        .impact-summary {
            background: white;
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            margin-top: 20px;
            grid-column: 1 / -1;
        }
        
        .impact-summary h2 {
            color: #003B5C;
            margin-bottom: 20px;
            border-bottom: 3px solid #FFA500;
            padding-bottom: 10px;
        }
        
        .impact-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .takehome-grid {
            display: flex;
            flex-wrap: wrap;
            justify-content: center; /* Center the cards */
            gap: 15px;
            margin-top: 15px;
        }
        
        .takehome-card {
            flex: 0 0 auto; /* Don't grow or shrink */
            width: 280px; /* Fixed width for consistency */
        }
        
        /* Responsive: smaller cards on mobile */
        @media (max-width: 768px) {
            .takehome-card {
                width: calc(50% - 10px);
                min-width: 200px;
            }
        }
        
        @media (max-width: 480px) {
            .takehome-card {
                width: 100%;
            }
        }
        
        .takehome-card {
            background: linear-gradient(135deg, #FFA500 0%, #FF8C00 100%);
            color: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            transition: background 0.3s ease;
        }
        
        .takehome-card.positive {
            background: linear-gradient(135deg, #28A745 0%, #20893B 100%);
        }
        
        .longevity-container {
            display: flex;
            justify-content: center;
            margin-top: 20px;
        }
        
        .longevity-bonus-card {
            background: linear-gradient(135deg, #8B4789 0%, #6B3669 100%);
            color: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            max-width: calc(33.333% - 10px); /* Same width as 1/3 of top row */
            min-width: 250px; /* Minimum width for readability */
        }
        
        @media (max-width: 768px) {
            .longevity-bonus-card {
                max-width: 100%;
            }
        }
        
        .longevity-bonus-card h4 {
            font-size: 1em;
            font-weight: 600;
            margin-bottom: 10px;
        }
        
        .longevity-bonus-card .value {
            font-size: 2.2em;
            font-weight: bold;
            margin: 10px 0;
        }
        
        .longevity-bonus-card .subvalue {
            font-size: 0.85em;
            opacity: 0.95;
        }
        
        .takehome-card h4 {
            font-size: 1em;
            font-weight: 600;
            margin-bottom: 10px;
        }
        
        .takehome-card .value {
            font-size: 2.2em;
            font-weight: bold;
            margin: 10px 0;
        }
        
        .takehome-card .subvalue {
            font-size: 0.85em;
            opacity: 0.95;
        }
        
        /* District Cost Cards - Teal */
        .district-cost-grid {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 15px;
            margin-top: 15px;
        }
        
        .district-cost-card {
            background: linear-gradient(135deg, #20B2AA 0%, #178F8A 100%);
            color: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            flex: 0 0 auto;
            width: 280px;
        }
        
        .district-cost-card h4 {
            font-size: 1em;
            font-weight: 600;
            margin-bottom: 10px;
        }
        
        .district-cost-card .value {
            font-size: 2.2em;
            font-weight: bold;
            margin: 10px 0;
        }
        
        .district-cost-card .subvalue {
            font-size: 0.85em;
            opacity: 0.95;
        }
        
        /* Total Cost Summary Card - Teal, centered */
        .total-cost-container {
            display: flex;
            flex-direction: column; /* Stack vertically */
            align-items: center; /* Center horizontally */
            margin-top: 20px;
        }
        
        .total-cost-card {
            background: linear-gradient(135deg, #1A9B94 0%, #147871 100%);
            color: white;
            padding: 20px; /* Reduced from 25px 20px */
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            max-width: calc(33.333% - 10px);
            min-width: 250px;
            border: 3px solid #D4AF37; /* Gold accent border */
        }
        
        .total-cost-card h4 {
            font-size: 1.1em;
            font-weight: 600;
            margin-bottom: 10px;
        }
        
        .total-cost-card .value {
            font-size: 2.5em;
            font-weight: bold;
            margin: 10px 0;
            color: #FFD700; /* Gold text for emphasis */
        }
        
        .total-cost-card .subvalue {
            font-size: 0.85em;
            opacity: 0.95;
        }
        
        /* Cost Breakdown Card - Light Teal */
        .cost-breakdown-card {
            background: linear-gradient(135deg, #B2DFDB 0%, #80CBC4 100%);
            color: #003B5C;
            padding: 20px;
            border-radius: 8px;
            text-align: left;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            max-width: calc(33.333% - 10px);
            min-width: 250px;
            margin-top: 15px;
        }
        
        .cost-breakdown-card h4 {
            font-size: 1em;
            font-weight: 600;
            margin-bottom: 12px;
            color: #003B5C;
        }
        
        .cost-breakdown-card ul {
            margin: 5px 0 0 20px;
            color: #555;
        }
        
        .cost-breakdown-card .disclaimer {
            font-size: 0.8em;
            color: #666;
            margin-top: 12px;
            font-style: italic;
            line-height: 1.4;
        }
        
        @media (max-width: 768px) {
            .cost-breakdown-card {
                max-width: 100%;
            }
        }
        
            opacity: 0.95;
        }
        
        @media (max-width: 768px) {
            .district-cost-card {
                width: calc(50% - 10px);
                min-width: 200px;
            }
            .total-cost-card {
                max-width: 100%;
            }
        }
        
        @media (max-width: 480px) {
            .district-cost-card {
                width: 100%;
            }
        }
        
        .impact-card {
            background: linear-gradient(135deg, #003B5C 0%, #004D73 100%);
            color: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
        }
        
        .impact-card h4 {
            font-size: 0.9em;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 10px;
            opacity: 0.9;
        }
        
        .impact-card .value {
            font-size: 2em;
            font-weight: bold;
            color: #FFA500;
            margin: 10px 0;
        }
        
        .impact-card .subvalue {
            font-size: 0.9em;
            opacity: 0.8;
        }
        
        /* Scenario comparison */
        .scenario-buttons {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-top: 15px;
        }
        
        .scenario-btn {
            padding: 12px;
            border: 2px solid #004D73;
            background: white;
            color: #004D73;
            font-weight: 600;
            cursor: pointer;
            border-radius: 5px;
            transition: all 0.3s;
        }
        
        .scenario-btn:hover {
            background: #E8F4F8;
        }
        
        /* Responsive */
        @media (max-width: 1200px) {
            .tool-layout {
                grid-template-columns: 1fr;
            }
            
            /* On smaller screens, chart goes on top and becomes non-sticky */
            .chart-section {
                position: relative;
                top: 0;
                max-height: none;
                margin-bottom: 20px;
            }
            
            .controls-panel {
                position: relative;
                max-height: none;
            }
        }
        
        /* Info box */
        .info-box {
            background: #FFF3CD;
            border-left: 4px solid #FFA500;
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
        }
        
        .info-box h4 {
            color: #856404;
            margin-bottom: 8px;
        }
        
        .info-box p {
            color: #856404;
            margin: 5px 0;
        }
        
        /* Verification Footer */
        .verification-footer {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-top: 3px solid #003B5C;
            margin-top: 40px;
            padding: 30px 0 20px 0;
            font-size: 0.9em;
        }
        
        .footer-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
        }
        
        .footer-header:hover {
            opacity: 0.8;
        }
        
        .toggle-footer-btn {
            background: #003B5C;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.95em;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .toggle-footer-btn:hover {
            background: #FFA500;
            transform: translateY(-2px);
        }
        
        #footerToggleIcon {
            display: inline-block;
            transition: transform 0.3s;
            margin-right: 8px;
        }
        
        .verification-footer h3 {
            color: #003B5C;
            font-size: 1.5em;
        }
        
        .footer-content {
            display: grid;
            grid-template-columns: 1fr;
            gap: 25px;
            margin-bottom: 20px;
        }
        
        .footer-section {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .footer-section h4 {
            color: #003B5C;
            margin-bottom: 12px;
            font-size: 1.1em;
        }
        
        .footer-section ul {
            margin: 10px 0;
            padding-left: 20px;
        }
        
        .footer-section li {
            margin: 8px 0;
            line-height: 1.6;
        }
        
        .footer-section p {
            margin: 12px 0;
            line-height: 1.7;
            color: #333;
        }
        
        .footer-section a {
            color: #0066A1;
            text-decoration: none;
            font-weight: 600;
        }
        
        .footer-section a:hover {
            color: #FFA500;
            text-decoration: underline;
        }
        
        .footer-section.disclaimer {
            background: #fff3cd;
            border-left: 4px solid #FFA500;
        }
        
        .footer-section.disclaimer ul {
            list-style-type: none;
            padding-left: 0;
        }
        
        .footer-section.disclaimer li {
            padding-left: 25px;
            position: relative;
        }
        
        .footer-section.disclaimer li:before {
            content: "‚ö†Ô∏è";
            position: absolute;
            left: 0;
        }
        
        .verification-link {
            margin-top: 15px;
            padding: 15px;
            background: #e7f3ff;
            border-left: 4px solid #0066A1;
            border-radius: 4px;
        }
        
        .verification-link a {
            font-size: 1.05em;
        }
        
        .footer-timestamp {
            text-align: center;
            color: #666;
            font-size: 0.85em;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #ddd;
        }
        
        @media (max-width: 1200px) {
            .verification-footer {
                padding: 30px 20px 20px 20px;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <h1>Interactive Salary Proposal Simulator</h1>
            <p class="subtitle">Explore different contract scenarios and see real-time impact on D100 teacher salaries</p>
            <p class="subtitle" style="color: #FFA500; font-weight: 600; margin-top: 10px;">‚ö†Ô∏è Confidential Information: This tool is part of the collective bargaining process, and should be viewed only by members of the bargaining team.</p>
        </div>
    </header>
    
    <div class="container">
        <div class="tool-layout">
            <!-- Chart Section -->
            <div class="chart-section">
                <h2>üìà Salary Comparison: Current vs Proposed</h2>
                
                <!-- Line Visibility Toggles -->
                <div class="line-toggles">
                    <h4>Click Here to Show/Hide Lines:</h4>
                    <div class="toggle-buttons">
                        <button class="toggle-btn active" data-dataset="0" style="border-color: #0066A1;">
                            <span class="toggle-indicator" style="background: #0066A1;"></span>
                            D100 Current
                        </button>
                        <button class="toggle-btn active" data-dataset="1" style="border-color: #FFA500;">
                            <span class="toggle-indicator" style="background: #FFA500;"></span>
                            D100 Proposed
                        </button>
                        <button class="toggle-btn active" data-dataset="2" style="border-color: #8B4789;">
                            <span class="toggle-indicator" style="background: #8B4789;"></span>
                            D98 Current
                        </button>
                        <button class="toggle-btn active" data-dataset="3" style="border-color: #8B4789;">
                            <span class="toggle-indicator" style="background: #8B4789;"></span>
                            D98 Future (dashed)
                        </button>
                        <button class="toggle-btn active" data-dataset="4" style="border-color: #D9534F;">
                            <span class="toggle-indicator" style="background: #D9534F;"></span>
                            D99 Current
                        </button>
                        <button class="toggle-btn active" data-dataset="5" style="border-color: #D9534F;">
                            <span class="toggle-indicator" style="background: #D9534F;"></span>
                            D99 Future (dashed)
                        </button>
                    </div>
                </div>
                
                <canvas id="salaryChart"></canvas>
            </div>
            
            <!-- Controls Panel -->
            <div class="controls-panel">
                <h2>Salary Proposal Controls</h2>
                
                <!-- Peer District Growth Assumptions -->
                <div class="control-group" style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 25px; border: 2px solid #ddd;">
                    <h3 style="margin-top: 0; color: #003B5C;">Peer District Growth Assumptions</h3>
                    <p style="font-size: 0.9em; color: #666; margin-bottom: 15px;">
                        Model different scenarios for how D98 and D99 salaries might grow during your contract.
                    </p>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 10px;">
                        <div>
                            <label style="display: block; font-weight: 600; margin-bottom: 8px; color: #8B4789;">
                                üü£ D98 Annual Growth:
                            </label>
                            <select id="d98Growth" class="growth-selector" style="width: 100%; padding: 10px; font-size: 1em; border: 2px solid #8B4789; border-radius: 6px; background: white; cursor: pointer;">
                                <option value="4">4% per year</option>
                                <option value="5">5% per year</option>
                                <option value="6">6% per year</option>
                            </select>
                        </div>
                        
                        <div>
                            <label style="display: block; font-weight: 600; margin-bottom: 8px; color: #D9534F;">
                                üî¥ D99 Annual Growth:
                            </label>
                            <select id="d99Growth" class="growth-selector" style="width: 100%; padding: 10px; font-size: 1em; border: 2px solid #D9534F; border-radius: 6px; background: white; cursor: pointer;">
                                <option value="4">4% per year</option>
                                <option value="5">5% per year</option>
                                <option value="6">6% per year</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <!-- Contract Length -->
                <div class="contract-length">
                    <label>Contract Length</label>
                    <div class="year-buttons">
                        <button class="year-btn active" data-years="2">2 Years</button>
                        <button class="year-btn" data-years="3">3 Years</button>
                        <button class="year-btn" data-years="4">4 Years</button>
                    </div>
                </div>
                
                <!-- Year-by-Year Controls -->
                <div id="yearControls">
                    <!-- Year 1 -->
                    <div class="control-group year-control" data-year="1">
                        <h3>üìÖ Year 1 (2026-2027)</h3>
                        
                        <div class="control-item">
                            <label>Lump Sum Payment</label>
                            <input type="number" class="year-lump-sum" data-year="1" min="0" max="10000" step="100" value="0">
                            <div class="value-display">
                                <span style="font-size: 0.9em; color: #666;">One-time payment</span>
                                <span class="current-value">$<span class="lump-sum-display">0</span></span>
                            </div>
                        </div>
                        
                        <div class="control-item">
                            <label>Percentage Raise</label>
                            <input type="range" class="year-percent" data-year="1" min="0" max="15" step="0.1" value="0">
                            <div class="value-display">
                                <span>Annual salary increase</span>
                                <span class="current-value"><span class="percent-display">0.0</span>%</span>
                            </div>
                            <div class="range-labels">
                                <span>0%</span>
                                <span>15%</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Year 2 -->
                    <div class="control-group year-control" data-year="2">
                        <h3>üìÖ Year 2 (2027-2028)</h3>
                        
                        <div class="control-item">
                            <label>Lump Sum Payment</label>
                            <input type="number" class="year-lump-sum" data-year="2" min="0" max="10000" step="100" value="0">
                            <div class="value-display">
                                <span style="font-size: 0.9em; color: #666;">One-time payment</span>
                                <span class="current-value">$<span class="lump-sum-display">0</span></span>
                            </div>
                        </div>
                        
                        <div class="control-item">
                            <label>Percentage Raise</label>
                            <input type="range" class="year-percent" data-year="2" min="0" max="15" step="0.1" value="0">
                            <div class="value-display">
                                <span>Annual salary increase</span>
                                <span class="current-value"><span class="percent-display">0.0</span>%</span>
                            </div>
                            <div class="range-labels">
                                <span>0%</span>
                                <span>15%</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Year 3 -->
                    <div class="control-group year-control" data-year="3" style="display: none;">
                        <h3>üìÖ Year 3 (2028-2029)</h3>
                        
                        <div class="control-item">
                            <label>Lump Sum Payment</label>
                            <input type="number" class="year-lump-sum" data-year="3" min="0" max="10000" step="100" value="0">
                            <div class="value-display">
                                <span style="font-size: 0.9em; color: #666;">One-time payment</span>
                                <span class="current-value">$<span class="lump-sum-display">0</span></span>
                            </div>
                        </div>
                        
                        <div class="control-item">
                            <label>Percentage Raise</label>
                            <input type="range" class="year-percent" data-year="3" min="0" max="15" step="0.1" value="0">
                            <div class="value-display">
                                <span>Annual salary increase</span>
                                <span class="current-value"><span class="percent-display">0.0</span>%</span>
                            </div>
                            <div class="range-labels">
                                <span>0%</span>
                                <span>15%</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Year 4 -->
                    <div class="control-group year-control" data-year="4" style="display: none;">
                        <h3>üìÖ Year 4 (2029-2030)</h3>
                        
                        <div class="control-item">
                            <label>Lump Sum Payment</label>
                            <input type="number" class="year-lump-sum" data-year="4" min="0" max="10000" step="100" value="0">
                            <div class="value-display">
                                <span style="font-size: 0.9em; color: #666;">One-time payment</span>
                                <span class="current-value">$<span class="lump-sum-display">0</span></span>
                            </div>
                        </div>
                        
                        <div class="control-item">
                            <label>Percentage Raise</label>
                            <input type="range" class="year-percent" data-year="4" min="0" max="15" step="0.1" value="0">
                            <div class="value-display">
                                <span>Annual salary increase</span>
                                <span class="current-value"><span class="percent-display">0.0</span>%</span>
                            </div>
                            <div class="range-labels">
                                <span>0%</span>
                                <span>15%</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Longevity Bonus -->
                <div class="control-group">
                    <h3>‚è∞ Longevity Bonus (Non-Compounding)</h3>
                    <div class="checkbox-wrapper">
                        <input type="checkbox" id="longevityEnabled">
                        <label for="longevityEnabled">Enable Longevity Bonus for Step 10+</label>
                    </div>
                    
                    <div class="longevity-controls" id="longevityControls">
                        <div class="control-item">
                            <label>Bonus Percentage</label>
                            <div class="year-buttons">
                                <button class="longevity-btn active" data-percent="2">2%</button>
                                <button class="longevity-btn" data-percent="3">3%</button>
                                <button class="longevity-btn" data-percent="4">4%</button>
                            </div>
                            <p style="font-size: 0.85em; color: #666; margin-top: 10px;">
                                <strong>Non-compounding:</strong> Bonus calculated on original base salary
                            </p>
                        </div>
                    </div>
                </div>
                
                
                <!-- Reset -->
                <button class="reset-btn" onclick="resetControls()">üîÑ Reset All Controls</button>
            </div>
        </div>
        
        <!-- Impact Summary -->
        <div class="impact-summary">
            <h2>üìä Proposal Impact Analysis</h2>
            
            <!-- Row 1: Comparison Metrics -->
            <div class="impact-grid">
                <div class="impact-card">
                    <h4>Average Gap vs D99</h4>
                    <div class="value"><span id="gapD99">‚àí$8,140</span></div>
                    <div class="subvalue"><span id="gapD99Percent">10.5</span>% <span id="gapD99Direction">behind</span></div>
                </div>
                <div class="impact-card">
                    <h4>Average Gap vs D98</h4>
                    <div class="value"><span id="gapD98">‚àí$4,396</span></div>
                    <div class="subvalue"><span id="gapD98Percent">5.7</span>% <span id="gapD98Direction">behind</span></div>
                </div>
                <div class="impact-card">
                    <h4>Avg. D100 Teacher Raise</h4>
                    <div class="value">$<span id="avgIncrease">0</span></div>
                    <div class="subvalue">Entire <span id="contractLengthLabel">2</span>-Year Contract</div>
                </div>
            </div>
            
            <!-- Row 2: Year-by-Year Take-Home Impact -->
            <h3 style="margin-top: 30px; margin-bottom: 15px; color: #003B5C;">üí∞ After-Tax Take-Home Impact per Paycheck</h3>
            <p style="margin-bottom: 15px; font-size: 0.95em; color: #666;">For the Average D100 Teacher</p>
            <div class="takehome-grid" id="takeHomeGrid">
                <!-- Dynamically populated based on contract length -->
            </div>
            
            <div class="longevity-container" id="longevityContainer">
                <!-- Longevity bonus card will be added here -->
            </div>
            
            <!-- District Cost Summary -->
            <h3 style="margin-top: 40px; margin-bottom: 15px; color: #003B5C;">üíº District Cost Summary</h3>
            <p style="margin-bottom: 15px; font-size: 0.95em; color: #666;">Annual Incremental Cost to District (based on 25/26 total bargaining unit payroll of $23.9M)</p>
            <div class="district-cost-grid" id="districtCostGrid">
                <!-- Dynamically populated based on contract length -->
            </div>
            
            <div class="total-cost-container" id="totalCostContainer">
                <!-- Total package cost card will be added here -->
            </div>
        </div>
    </div>
    
    <!-- Data Sources and Verification Footer -->
    <footer class="verification-footer">
        <div class="container">
            <div class="footer-header" onclick="toggleFooter()" style="cursor: pointer;">
                <h3 style="display: inline-block; margin-bottom: 0;">üìö Data Sources & Verification</h3>
                <button class="toggle-footer-btn" id="toggleFooterBtn">
                    <span id="footerToggleIcon">‚ñº</span> Click to expand
                </button>
            </div>
            
            <div class="footer-content" id="footerContent" style="display: none; margin-top: 20px;">
                <div class="footer-section">
                    <h4>Salary Data Sources (2025-2026 School Year)</h4>
                    <ul>
                        <li><strong>D100 (South Berwyn):</strong> D100_vs_D99_vs_D98_Salary_Comparison_Grid.csv - Mutually agreed comparison document from interest-based bargaining process</li>
                        <li><strong>D98 (North Berwyn):</strong> D100_vs_D99_vs_D98_Salary_Comparison_Grid.csv + 
                            <a href="https://drive.google.com/file/d/1o26qV0f62VZIZ4IiLVA9f-jihK7uC1Y7/view" target="_blank" rel="noopener">
                                Official D98 Collective Bargaining Agreement ‚Üí
                            </a>
                        </li>
                        <li><strong>D99 (Cicero, Cook County):</strong> Official 2025-2026 salary schedule screenshots + 
                            <a href="https://drive.google.com/file/d/1Smgm74lXWj3u2kccXYoq30Cl7qVQM0Ku/view" target="_blank" rel="noopener">
                                Official D99 Contract Documents ‚Üí
                            </a>
                        </li>
                    </ul>
                </div>
                
                <div class="footer-section">
                    <h4>Data Verification</h4>
                    <p>
                        All salary data in this simulator has been verified for 100% accuracy against source documents. 
                        Every salary figure for D100, D98, and D99 was cross-checked line-by-line to ensure complete accuracy 
                        for use in collective bargaining proceedings.
                    </p>
                    <p>
                        <strong>What was verified:</strong> All current baseline salaries (41 data points across 3 districts), 
                        mathematical calculation formulas for future projections, and proper handling of missing data points 
                        where districts have different salary schedules.
                    </p>
                    <p>
                        <strong>How verification was conducted:</strong> Each salary in the simulator was compared against the 
                        source CSV file or official salary schedule. All 41 data points matched exactly (100% accuracy). 
                        Mathematical formulas were tested with multiple scenarios to ensure correct compound growth calculations.
                    </p>
                    <p class="verification-link">
                        üìÑ <a href="SALARY_DATA_VERIFICATION_REPORT.html" target="_blank">
                            View Complete Verification Report (includes line-by-line verification of all data)
                        </a>
                    </p>
                </div>
                
                <div class="footer-section disclaimer">
                    <h4>Important Notes</h4>
                    <ul>
                        <li><strong>Current Salaries (Solid Lines):</strong> All current D100, D98, and D99 salaries are verified factual data from 2025-2026 salary schedules.</li>
                        <li><strong>Future Projections (Dashed Lines):</strong> D98 and D99 future salaries are projections based on user-selected growth assumptions (4%, 5%, or 6% annually). These are modeling tools for planning purposes - actual peer district salary increases may differ.</li>
                        <li><strong>Your Proposal (Orange Line):</strong> Shows the impact of salary increases you configure using the controls on the right.</li>
                        <li><strong>Confidential:</strong> This tool is part of the collective bargaining process and should be viewed only by members of the bargaining team.</li>
                    </ul>
                </div>
                
                <div class="footer-timestamp">
                    Data verified: December 22, 2024 | Based on 2025-2026 salary schedules | All source documents mutually agreed in interest-based bargaining
                </div>
            </div>
        </div>
    </footer>
    
    <script>
        // Original salary data (2025-2026 baseline)
        const salaryData = {
            positions: [
                'B @ 1yr', 'B @ 10yr', 'B @ 13yr',
                'M @ 1yr', 'M @ 10yr', 'M @ 20yr', 'M @ 25yr',
                'M+32 @ 1yr', 'M+32 @ 10yr', 'M+32 @ 20yr', 'M+32 @ 25yr',
                'M+45 @ 1yr', 'M+45 @ 10yr', 'M+45 @ 20yr', 'M+45 @ 25yr'
            ],
            steps: [1, 10, 13, 1, 10, 20, 25, 1, 10, 20, 25, 1, 10, 20, 25],
            d100Original: [51367, 64293, 67539, 56545, 70730, 85439, 93826, 59392, 72965, 88302, 95961, 62157, 77700, 92073, 101622],
            
            // D98 (North Berwyn) current (2025-2026)
            d98Current: [53491, 64532, 69403, 60029, 72605, 90299, null, 64301, 77735, 95740, 104081, 67164, 81175, 99339, 107735],
            
            // D99 (Cicero - Cook County) current (2025-2026) - CORRECTED!
            d99Current: [62800, 74754, 79330, 66457, 80402, 98918, 104898, null, null, null, null, 70273, 83652, 104662, 111371]
        };
        
        // Current state
        let contractYears = 2;
        let yearData = {
            1: { lumpSum: 0, percent: 0 },
            2: { lumpSum: 0, percent: 0 },
            3: { lumpSum: 0, percent: 0 },
            4: { lumpSum: 0, percent: 0 }
        };
        let longevityEnabled = false;
        let longevityPercent = 2;
        let d98GrowthRate = 4;  // Default 4% annual growth
        let d99GrowthRate = 4;  // Default 4% annual growth
        
        // Initialize chart
        let chart;
        
        // Calculate D98 future salaries based on selected growth rate
        function getD98FutureSalaries() {
            const yearsOut = contractYears;
            const growthMultiplier = Math.pow(1 + (d98GrowthRate / 100), yearsOut);
            
            return salaryData.d98Current.map(salary => {
                if (salary === null) return null;
                return Math.round(salary * growthMultiplier);
            });
        }
        
        // Calculate D99 future salaries based on selected growth rate
        function getD99FutureSalaries() {
            const yearsOut = contractYears;
            const growthMultiplier = Math.pow(1 + (d99GrowthRate / 100), yearsOut);
            
            return salaryData.d99Current.map(salary => {
                if (salary === null) return null;
                return Math.round(salary * growthMultiplier);
            });
        }
        
        function initChart() {
            const ctx = document.getElementById('salaryChart').getContext('2d');
            chart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: salaryData.positions,
                    datasets: [
                        {
                            label: 'D100 Current (2025-26)',
                            data: salaryData.d100Original,
                            borderColor: '#0066A1',
                            backgroundColor: 'rgba(0, 102, 161, 0.1)',
                            borderWidth: 3,
                            pointRadius: 5,
                            pointHoverRadius: 7
                        },
                        {
                            label: 'D100 Proposed (End of Contract)',
                            data: salaryData.d100Original,
                            borderColor: '#FFA500',
                            backgroundColor: 'rgba(255, 165, 0, 0.1)',
                            borderWidth: 4,
                            pointRadius: 5,
                            pointHoverRadius: 7,
                            tension: 0.1
                        },
                        {
                            label: 'D98 (N. Berwyn) - Current',
                            data: salaryData.d98Current,
                            borderColor: '#8B4789',
                            backgroundColor: 'rgba(139, 71, 137, 0.1)',
                            borderWidth: 3,
                            pointRadius: 5,
                            pointHoverRadius: 7
                        },
                        {
                            label: 'D98 (N. Berwyn) - Future (dashed)',
                            data: getD98FutureSalaries(),
                            borderColor: '#8B4789',
                            backgroundColor: 'rgba(139, 71, 137, 0.1)',
                            borderWidth: 2,
                            borderDash: [5, 5],
                            pointRadius: 4,
                            pointHoverRadius: 6
                        },
                        {
                            label: 'D99 (Cicero) - Current',
                            data: salaryData.d99Current,
                            borderColor: '#D9534F',
                            backgroundColor: 'rgba(217, 83, 79, 0.1)',
                            borderWidth: 3,
                            pointRadius: 5,
                            pointHoverRadius: 7
                        },
                        {
                            label: 'D99 (Cicero) - Future (dashed)',
                            data: getD99FutureSalaries(),
                            borderColor: '#D9534F',
                            backgroundColor: 'rgba(217, 83, 79, 0.1)',
                            borderWidth: 2,
                            borderDash: [5, 5],
                            pointRadius: 4,
                            pointHoverRadius: 6
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        title: {
                            display: false
                        },
                        legend: {
                            display: true,
                            position: 'top',
                            labels: {
                                font: { size: 11 },
                                padding: 10,
                                usePointStyle: true
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    let label = context.dataset.label || '';
                                    if (label) {
                                        label += ': ';
                                    }
                                    if (context.parsed.y !== null) {
                                        label += '$' + context.parsed.y.toLocaleString();
                                    }
                                    return label;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: false,
                            ticks: {
                                callback: function(value) {
                                    return '$' + value.toLocaleString();
                                }
                            },
                            title: {
                                display: true,
                                text: 'Annual Salary',
                                font: { size: 14, weight: 'bold' }
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Position (Education Level @ Years of Service)',
                                font: { size: 14, weight: 'bold' }
                            }
                        }
                    }
                }
            });
        }
        
        function calculateProposedSalaries() {
            const proposed = salaryData.d100Original.map((baseSalary, idx) => {
                let newSalary = baseSalary;
                const step = salaryData.steps[idx];
                const originalSalary = baseSalary;
                
                // Apply year-by-year increases
                for (let year = 1; year <= contractYears; year++) {
                    // Add lump sum for this year
                    newSalary += yearData[year].lumpSum;
                    
                    // Apply percentage increase (compounds on current salary)
                    newSalary = newSalary * (1 + yearData[year].percent / 100);
                }
                
                // Apply longevity bonus (non-compounding, based on ORIGINAL salary)
                if (longevityEnabled && step >= 10) {
                    newSalary += originalSalary * (longevityPercent / 100);
                }
                
                return Math.round(newSalary);
            });
            
            return proposed;
        }
        
        function updateChart() {
            const proposed = calculateProposedSalaries();
            const d98Future = getD98FutureSalaries();
            const d99Future = getD99FutureSalaries();
            
            // Update D100 proposed
            chart.data.datasets[1].data = proposed;
            
            // Update D98 future data
            chart.data.datasets[3].data = d98Future;
            
            // Update D99 future data
            chart.data.datasets[5].data = d99Future;
            
            // Update labels with contract end year and growth rates
            const endYearMap = {
                2: '2027-28',
                3: '2028-29',
                4: '2029-30'
            };
            chart.data.datasets[3].label = `D98 (N. Berwyn) - ${endYearMap[contractYears]} (dashed) ${d98GrowthRate}%/yr`;
            chart.data.datasets[5].label = `D99 (Cicero) - ${endYearMap[contractYears]} (dashed) ${d99GrowthRate}%/yr`;
            
            chart.update();
            updateImpactMetrics(proposed, d98Future, d99Future);
        }
        
        function updateImpactMetrics(proposed, d98Future, d99Future) {
            // Calculate D100 proposed salaries WITHOUT longevity for fair comparison
            const proposedWithoutLongevity = salaryData.d100Original.map((baseSalary, idx) => {
                let newSalary = baseSalary;
                
                // Apply year-by-year increases (NO longevity)
                for (let year = 1; year <= contractYears; year++) {
                    newSalary += yearData[year].lumpSum;
                    newSalary = newSalary * (1 + yearData[year].percent / 100);
                }
                
                return Math.round(newSalary);
            });
            
            // Calculate gaps against FUTURE salaries (using base salary only, no longevity)
            let d98Gaps = [];
            let d99Gaps = [];
            
            proposedWithoutLongevity.forEach((salary, idx) => {
                if (d98Future[idx]) {
                    const gap = d98Future[idx] - salary;
                    d98Gaps.push(gap);
                }
                if (d99Future[idx]) {
                    d99Gaps.push(d99Future[idx] - salary);
                }
            });
            
            const avgGapD98 = Math.round(d98Gaps.reduce((a, b) => a + b, 0) / d98Gaps.length);
            const avgGapD99 = Math.round(d99Gaps.reduce((a, b) => a + b, 0) / d99Gaps.length);
            
            const avgD98 = d98Future.filter(x => x).reduce((a, b) => a + b, 0) / d98Future.filter(x => x).length;
            const avgGapD98Percent = ((avgGapD98 / avgD98) * 100).toFixed(1);
            
            const avgD99 = d99Future.filter(x => x).reduce((a, b) => a + b, 0) / d99Future.filter(x => x).length;
            const avgGapD99Percent = ((avgGapD99 / avgD99) * 100).toFixed(1);
            
            // Calculate average increase WITHOUT longevity (base raises only)
            const totalIncrease = proposedWithoutLongevity.reduce((a, b) => a + b, 0) - salaryData.d100Original.reduce((a, b) => a + b, 0);
            const avgIncrease = Math.round(totalIncrease / proposedWithoutLongevity.length);
            
            // Update comparison metrics with +/- signs
            // Positive gap = behind (bad), show minus sign
            // Negative gap = ahead (good), show plus sign
            const d98Sign = avgGapD98 > 0 ? '‚àí' : '+';
            const d99Sign = avgGapD99 > 0 ? '‚àí' : '+';
            
            document.getElementById('gapD98').textContent = d98Sign + '$' + Math.abs(avgGapD98).toLocaleString();
            document.getElementById('gapD98Percent').textContent = Math.abs(avgGapD98Percent);
            document.getElementById('gapD98Direction').textContent = avgGapD98 > 0 ? 'behind' : 'ahead';
            
            document.getElementById('gapD99').textContent = d99Sign + '$' + Math.abs(avgGapD99).toLocaleString();
            document.getElementById('gapD99Percent').textContent = Math.abs(avgGapD99Percent);
            document.getElementById('gapD99Direction').textContent = avgGapD99 > 0 ? 'behind' : 'ahead';
            
            document.getElementById('avgIncrease').textContent = avgIncrease.toLocaleString();
            document.getElementById('contractLengthLabel').textContent = contractYears;
            
            // Calculate year-by-year take-home impact
            calculateYearByYearTakeHome();
            
            // Calculate district costs
            calculateDistrictCosts();
        }
        
        function calculateYearByYearTakeHome() {
            const takeHomeGrid = document.getElementById('takeHomeGrid');
            const longevityContainer = document.getElementById('longevityContainer');
            takeHomeGrid.innerHTML = ''; // Clear existing year cards
            longevityContainer.innerHTML = ''; // Clear existing longevity card
            
            // Calculate average salary increase for each year (WITHOUT longevity)
            let yearlyTakeHome = [];
            
            for (let year = 1; year <= contractYears; year++) {
                // Calculate what the average teacher's salary would be at end of this year (NO longevity)
                let yearEndSalaries = salaryData.d100Original.map((baseSalary, idx) => {
                    let salary = baseSalary;
                    
                    // Apply raises year by year up to current year (NO longevity)
                    for (let y = 1; y <= year; y++) {
                        const lumpSum = yearData[y].lumpSum;
                        const percent = yearData[y].percent / 100;
                        
                        salary = (salary + lumpSum) * (1 + percent);
                    }
                    
                    return salary;
                });
                
                // Calculate previous year salaries (NO longevity)
                let previousYearSalaries;
                if (year === 1) {
                    previousYearSalaries = salaryData.d100Original;
                } else {
                    previousYearSalaries = salaryData.d100Original.map((baseSalary, idx) => {
                        let salary = baseSalary;
                        
                        for (let y = 1; y < year; y++) {
                            const lumpSum = yearData[y].lumpSum;
                            const percent = yearData[y].percent / 100;
                            
                            salary = (salary + lumpSum) * (1 + percent);
                        }
                        
                        return salary;
                    });
                }
                
                // Calculate the INCREMENTAL increase for this year (NO longevity)
                const avgYearEndSalary = yearEndSalaries.reduce((a, b) => a + b, 0) / yearEndSalaries.length;
                const avgPreviousYearSalary = previousYearSalaries.reduce((a, b) => a + b, 0) / previousYearSalaries.length;
                const yearIncrease = avgYearEndSalary - avgPreviousYearSalary;
                
                // Calculate take-home per paycheck for this year's increase
                const takeHomePerPaycheck = Math.round((yearIncrease * 0.72) / 26);
                yearlyTakeHome.push(takeHomePerPaycheck);
                
                // Check if this year uses a percentage raise
                const hasPercentRaise = yearData[year].percent > 0;
                
                // Create card for this year
                const card = document.createElement('div');
                // Add 'positive' class if amount > 0, otherwise stays yellow (warning)
                card.className = takeHomePerPaycheck > 0 ? 'takehome-card positive' : 'takehome-card';
                card.innerHTML = `
                    <h4>Year ${year} (${2025 + year}-${String(2026 + year).slice(-2)})</h4>
                    <div class="value">+$${takeHomePerPaycheck.toLocaleString()}</div>
                    <div class="subvalue">Per paycheck (after taxes)${hasPercentRaise ? '<br><em style="font-size: 0.9em;">Based on avg. teacher</em>' : ''}</div>
                `;
                takeHomeGrid.appendChild(card);
            }
            
            // Add longevity bonus card if enabled
            if (longevityEnabled) {
                // Calculate how many teachers have 10+ years (for averaging)
                const eligibleTeachers = salaryData.steps.filter(step => step >= 10).length;
                const totalTeachers = salaryData.steps.length;
                
                // Calculate average longevity bonus across ALL teachers (including those not eligible)
                const avgBaseSalary = salaryData.d100Original.reduce((a, b) => a + b, 0) / salaryData.d100Original.length;
                const longevityBonus = avgBaseSalary * (longevityPercent / 100) * (eligibleTeachers / totalTeachers);
                const longevityTakeHome = Math.round((longevityBonus * 0.72) / 26);
                
                // Create purple longevity card
                const longevityCard = document.createElement('div');
                longevityCard.className = 'longevity-bonus-card';
                longevityCard.innerHTML = `
                    <h4>üíú Longevity Bonus (Non-Compounding)</h4>
                    <div class="value">+$${longevityTakeHome.toLocaleString()}</div>
                    <div class="subvalue">Per paycheck (after-tax) for teachers with 10+ years of service to D100<br><em style="font-size: 0.9em;">${longevityPercent}% of base salary</em></div>
                `;
                longevityContainer.appendChild(longevityCard);
            }
        }
        
        function updateYearVisibility() {
            document.querySelectorAll('.year-control').forEach(ctrl => {
                const year = parseInt(ctrl.dataset.year);
                ctrl.style.display = year <= contractYears ? 'block' : 'none';
            });
        }
        
        function calculateDistrictCosts() {
            const districtCostGrid = document.getElementById('districtCostGrid');
            const totalCostContainer = document.getElementById('totalCostContainer');
            districtCostGrid.innerHTML = ''; // Clear existing cards
            totalCostContainer.innerHTML = ''; // Clear total card
            
            // Base district payroll (from scattergram - includes retirees for now)
            const basePayroll = 23868588;
            const totalTeachers = 325; // Union members
            
            // Estimate Step 10+ payroll (60% based on 9 of 15 positions at Step 10+)
            const step10Percentage = 0.60;
            let step10Payroll = basePayroll * step10Percentage;
            
            let yearlyCosts = [];
            let yearlyBaseCosts = [];
            let yearlyLongevityCosts = [];
            let cumulativePayroll = basePayroll;
            
            // Calculate cost for each year
            for (let year = 1; year <= contractYears; year++) {
                // Calculate what payroll would be after this year's raises (base salary only)
                let newPayroll = cumulativePayroll;
                
                // Apply lump sum to all teachers
                const lumpSumCost = yearData[year].lumpSum * totalTeachers;
                newPayroll += lumpSumCost;
                
                // Apply percentage increase to current payroll
                const percentCost = newPayroll * (yearData[year].percent / 100);
                newPayroll += percentCost;
                
                // Calculate base salary cost for this year (before longevity)
                const baseCost = newPayroll - cumulativePayroll;
                
                // Calculate longevity cost if enabled
                // Longevity is applied AFTER raises, based on new salary
                let longevityCost = 0;
                if (longevityEnabled) {
                    // Update Step 10+ payroll proportionally with raises
                    step10Payroll = step10Payroll + (lumpSumCost * step10Percentage);
                    step10Payroll = step10Payroll * (1 + yearData[year].percent / 100);
                    
                    // Longevity is % of the NEW raised salary
                    longevityCost = step10Payroll * (longevityPercent / 100);
                }
                
                // Total cost for this year
                const totalYearCost = baseCost + longevityCost;
                
                yearlyCosts.push(totalYearCost);
                yearlyBaseCosts.push(baseCost);
                yearlyLongevityCosts.push(longevityCost);
                
                // Create card for this year
                const card = document.createElement('div');
                card.className = 'district-cost-card';
                const longevityNote = longevityEnabled ? '<br><em style="font-size: 0.85em; opacity: 0.9;">(incl. longevity)</em>' : '';
                card.innerHTML = `
                    <h4>Year ${year} (${2025 + year}-${String(2026 + year).slice(-2)})</h4>
                    <div class="value">$${Math.round(totalYearCost).toLocaleString()}</div>
                    <div class="subvalue">Incremental district cost${longevityNote}</div>
                `;
                districtCostGrid.appendChild(card);
                
                // Update cumulative for next year (base salary only - longevity doesn't compound into base)
                cumulativePayroll = newPayroll;
            }
            
            // Calculate total cost over entire contract
            const totalCost = yearlyCosts.reduce((a, b) => a + b, 0);
            const totalBaseCost = yearlyBaseCosts.reduce((a, b) => a + b, 0);
            const totalLongevityCost = yearlyLongevityCosts.reduce((a, b) => a + b, 0);
            
            // Create total cost summary card
            const totalCard = document.createElement('div');
            totalCard.className = 'total-cost-card';
            totalCard.innerHTML = `
                <h4>üí∞ Total Package Cost</h4>
                <div class="value">$${Math.round(totalCost).toLocaleString()}</div>
                <div class="subvalue">Entire ${contractYears}-Year Contract</div>
            `;
            totalCostContainer.appendChild(totalCard);
            
            // Add cost breakdown if longevity is enabled
            if (longevityEnabled) {
                const breakdownCard = document.createElement('div');
                breakdownCard.className = 'cost-breakdown-card';
                
                let breakdownHTML = `
                    <h4>üìã Cost Breakdown</h4>
                    <div style="line-height: 1.8;">
                        <strong>Base salary increases:</strong> $${Math.round(totalBaseCost).toLocaleString()}<br>
                        <strong>Longevity bonuses (${contractYears} years):</strong> $${Math.round(totalLongevityCost).toLocaleString()}*
                        <ul style="margin: 5px 0 0 20px;">
                `;
                
                for (let i = 0; i < contractYears; i++) {
                    breakdownHTML += `<li>Year ${i + 1}: $${Math.round(yearlyLongevityCosts[i]).toLocaleString()}</li>`;
                }
                
                breakdownHTML += `
                        </ul>
                        <div class="disclaimer">
                            *Longevity cost estimated based on 60% of bargaining unit at 10+ years. 
                            Actual cost pending HR verification of years of service to D100.
                        </div>
                    </div>
                `;
                
                breakdownCard.innerHTML = breakdownHTML;
                totalCostContainer.appendChild(breakdownCard);
            }
        }
        
        // Event listeners
        document.querySelectorAll('.year-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                document.querySelectorAll('.year-btn').forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                contractYears = parseInt(this.dataset.years);
                updateYearVisibility();
                updateChart();
            });
        });
        
        // Year-specific lump sum inputs
        document.querySelectorAll('.year-lump-sum').forEach(input => {
            input.addEventListener('input', function() {
                const year = parseInt(this.dataset.year);
                const value = parseFloat(this.value) || 0;
                yearData[year].lumpSum = value;
                this.parentElement.querySelector('.lump-sum-display').textContent = value.toLocaleString();
                updateChart();
            });
        });
        
        // Year-specific percentage sliders
        document.querySelectorAll('.year-percent').forEach(input => {
            input.addEventListener('input', function() {
                const year = parseInt(this.dataset.year);
                const value = parseFloat(this.value);
                yearData[year].percent = value;
                this.parentElement.querySelector('.percent-display').textContent = value.toFixed(1);
                updateChart();
            });
        });
        
        // Longevity toggle
        document.getElementById('longevityEnabled').addEventListener('change', function() {
            longevityEnabled = this.checked;
            document.getElementById('longevityControls').classList.toggle('active', longevityEnabled);
            updateChart();
        });
        
        // Longevity percentage buttons
        document.querySelectorAll('.longevity-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                document.querySelectorAll('.longevity-btn').forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                longevityPercent = parseInt(this.dataset.percent);
                if (longevityEnabled) updateChart();
            });
        });
        
        // Line visibility toggles
        document.querySelectorAll('.toggle-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                const datasetIndex = parseInt(this.dataset.dataset);
                const isVisible = chart.isDatasetVisible(datasetIndex);
                
                // Toggle visibility in chart
                if (isVisible) {
                    chart.hide(datasetIndex);
                    this.classList.remove('active');
                } else {
                    chart.show(datasetIndex);
                    this.classList.add('active');
                }
            });
        });
        
        function loadScenario(type) {
            resetControls();
            
            if (type === 'conservative') {
                // 6%, 6% - Match D98
                setYearValue(1, 'percent', 6);
                setYearValue(2, 'percent', 6);
            } else if (type === 'moderate') {
                // 7%, 6% + longevity
                setYearValue(1, 'percent', 7);
                setYearValue(2, 'percent', 6);
                document.getElementById('longevityEnabled').checked = true;
                longevityEnabled = true;
                document.querySelectorAll('.longevity-btn').forEach(b => b.classList.remove('active'));
                document.querySelector('.longevity-btn[data-percent="3"]').classList.add('active');
                longevityPercent = 3;
                document.getElementById('longevityControls').classList.add('active');
            } else if (type === 'aspirational') {
                // $5,000 lump + 10% - Aggressive catch-up
                setYearValue(1, 'lumpSum', 5000);
                setYearValue(1, 'percent', 10);
                setYearValue(2, 'percent', 8);
            }
            
            updateChart();
        }
        
        function setYearValue(year, type, value) {
            if (type === 'lumpSum') {
                const input = document.querySelector(`.year-lump-sum[data-year="${year}"]`);
                input.value = value;
                yearData[year].lumpSum = value;
                input.parentElement.querySelector('.lump-sum-display').textContent = value.toLocaleString();
            } else if (type === 'percent') {
                const input = document.querySelector(`.year-percent[data-year="${year}"]`);
                input.value = value;
                yearData[year].percent = value;
                input.parentElement.querySelector('.percent-display').textContent = value.toFixed(1);
            }
        }
        
        function toggleFooter() {
            const content = document.getElementById('footerContent');
            const icon = document.getElementById('footerToggleIcon');
            const btn = document.getElementById('toggleFooterBtn');
            
            if (content.style.display === 'none') {
                content.style.display = 'block';
                icon.textContent = '‚ñ≤';
                icon.style.transform = 'rotate(180deg)';
                btn.innerHTML = '<span id="footerToggleIcon" style="transform: rotate(180deg); display: inline-block;">‚ñ≤</span> Click to collapse';
            } else {
                content.style.display = 'none';
                icon.textContent = '‚ñº';
                icon.style.transform = 'rotate(0deg)';
                btn.innerHTML = '<span id="footerToggleIcon">‚ñº</span> Click to expand';
            }
        }
        
        function resetControls() {
            // Reset year buttons
            document.querySelectorAll('.year-btn').forEach(b => b.classList.remove('active'));
            document.querySelector('.year-btn[data-years="2"]').classList.add('active');
            contractYears = 2;
            updateYearVisibility();
            
            // Reset all year data
            for (let year = 1; year <= 4; year++) {
                yearData[year] = { lumpSum: 0, percent: 0 };
                
                const lumpInput = document.querySelector(`.year-lump-sum[data-year="${year}"]`);
                if (lumpInput) {
                    lumpInput.value = 0;
                    lumpInput.parentElement.querySelector('.lump-sum-display').textContent = '0';
                }
                
                const percentInput = document.querySelector(`.year-percent[data-year="${year}"]`);
                if (percentInput) {
                    percentInput.value = 0;
                    percentInput.parentElement.querySelector('.percent-display').textContent = '0.0';
                }
            }
            
            // Reset longevity
            document.getElementById('longevityEnabled').checked = false;
            longevityEnabled = false;
            document.getElementById('longevityControls').classList.remove('active');
            
            document.querySelectorAll('.longevity-btn').forEach(b => b.classList.remove('active'));
            document.querySelector('.longevity-btn[data-percent="2"]').classList.add('active');
            longevityPercent = 2;
            
            updateChart();
        }
        
        // Initialize on load
        window.addEventListener('load', function() {
            initChart();
            updateYearVisibility();
            updateImpactMetrics(salaryData.d100Original, getD98FutureSalaries(), getD99FutureSalaries());
            
            // Attach peer district growth rate selectors AFTER DOM is loaded
            document.getElementById('d98Growth').addEventListener('change', function() {
                d98GrowthRate = parseInt(this.value);
                updateChart();
            });
            
            document.getElementById('d99Growth').addEventListener('change', function() {
                d99GrowthRate = parseInt(this.value);
                updateChart();
            });
        });
    </script>
</body>
</html>
